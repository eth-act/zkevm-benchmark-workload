# Witness Generator

This crate generates execution witnesses for Ethereum blockchain test cases.

## Overview

The primary purpose of this crate is to process standard Ethereum test suites (specifically blockchain tests found in `zkevm-fixtures`) and produce execution witnesses for each block transition within those tests.

It defines the `BlocksAndWitnesses` struct which encapsulates:

- The name of a specific test case.
- A sequence of `ClientInput` objects, where each `ClientInput` pairs an Ethereum block with its corresponding execution witness generated by `ef-tests`.
- The `ForkSpec` indicating the network rules under which the test was executed. It is needed for guest execution since we want to execute blocks on a particular network (Mainnet, Hoodi, etc).

The main function provided is `generate_witness::generate()`, which:

1. Locates the specified blockchain test suite directory (`zkevm-fixtures/fixtures/blockchain_tests` by default).
2. Parses all JSON test case files within that directory.
3. Executes each test case using `ef_tests::cases::blockchain_test::run_case`.
4. Collects the resulting blocks and generated witnesses.
5. Packages them into a `Vec<BlocksAndWitnesses>`.

The crate also provides utility functions for serializing `Vec<BlocksAndWitnesses>` to and deserializing from JSON files (`to_path`, `from_path`).

## Usage

This crate is primarily intended to be used as a binary or integrated into other tooling that requires pre-generated execution witnesses for specific test cases.

To use the library functionality:

```toml
[dependencies]
witness-generator = { path = "../witness-generator" } # Adjust path as needed
```

Example (conceptual):

```rust
use witness_generator::generate_stateless_witness::generate;
use witness_generator::BlocksAndWitnesses;
use std::env::temp_dir;

fn main() -> Result<(), Box<dyn std::error::Error>> {
    println!("Generating witnesses...");
    // let all_test_witnesses: Vec<BlocksAndWitnesses> = generate();
    let all_test_witnesses: Vec<BlocksAndWitnesses> = Default::default();
    println!("Generated witness data for {} test cases.", all_test_witnesses.len());

    // Create a path in the system's temp directory
    let output_path = temp_dir().join("generated_witnesses.json");
    
    // Optionally, serialize to a file
    BlocksAndWitnesses::to_path(&output_path, &all_test_witnesses)?;
    println!("Witness data saved to {:?}", &output_path);

    // Later, deserialize
    let loaded_witnesses = BlocksAndWitnesses::from_path(output_path)?;
    println!("Loaded {} test cases from file.", loaded_witnesses.len());

    Ok(())
}
```

## Error Handling

The serialization/deserialization functions (`to_path`, `from_path`, `to_json`, `from_json`) return `Result<_, BwError>`.

The `generate` function may panic if test files cannot be loaded or if `run_case` fails internally.

## License

This crate inherits its license from the workspace. See the root `Cargo.toml` or `LICENSE` file.
