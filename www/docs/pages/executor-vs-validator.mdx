# Executor vs Validator: Choosing the Right Guest Program

This guide helps you choose between `stateless-executor` and `stateless-validator` guest programs for your benchmarking needs.

## Quick Decision Guide

```
┌─────────────────────────────────────────────────────────────────────────┐
│                    Which Guest Program Should I Use?                     │
└─────────────────────────────────────────────────────────────────────────┘

Do you need to measure realistic block validation workloads?
    │
    ├── YES → Do you need both Reth and Ethrex support?
    │             │
    │             ├── YES → Use stateless-validator
    │             │
    │             └── NO → Use stateless-validator (more realistic)
    │                      OR stateless-executor (for comparison)
    │
    └── NO → Are you benchmarking pure EVM/opcode execution?
                 │
                 ├── YES → Use stateless-executor
                 │
                 └── NO → Consider empty-program for baseline overhead
```

---

## Feature Comparison

| Feature | stateless-executor | stateless-validator |
|---------|:------------------:|:-------------------:|
| **Purpose** | Pure EVM execution measurement | Full block validation |
| **Pre-execution validation** | ❌ Skipped | ✅ Performed |
| **Post-execution validation** | ❌ Skipped | ✅ Performed |
| **State root verification** | ❌ Skipped | ✅ Performed |
| **Receipts root validation** | ❌ Skipped | ✅ Performed |
| **EVM transaction execution** | ✅ Performed | ✅ Performed |
| **Reth support** | ✅ Supported | ✅ Supported |
| **Ethrex support** | ❌ Not supported | ✅ Supported |
| **Realistic workload** | ⚠️ Partial | ✅ Full |
| **Cycle isolation** | ✅ Pure execution | ⚠️ Includes validation |

---

## When to Use Each

### Use `stateless-executor` when:

1. **Benchmarking opcode costs**: You want to measure the raw cycle cost of EVM opcodes without validation overhead.

2. **Comparing execution implementations**: You're comparing different EVM implementations and want to isolate execution performance.

3. **Optimizing execution paths**: You're working on EVM execution optimization and need accurate cycle measurements.

4. **Research and analysis**: You're studying EVM execution characteristics in zkVM environments.

5. **Reth-only workflows**: You only need Reth execution client support.

### Use `stateless-validator` when:

1. **Realistic benchmarking**: You want to measure the complete cost of validating Ethereum blocks.

2. **Production workload simulation**: Your benchmarks should reflect real-world zkEVM proving costs.

3. **Multi-client comparison**: You need to compare performance between Reth and Ethrex execution clients.

4. **End-to-end validation**: You want to ensure the full validation pipeline is working correctly.

5. **Consensus compatibility**: Your benchmarks should include consensus-related validation costs.

---

## Performance Implications

### Cycle Count Differences

The stateless-executor will show **lower cycle counts** than the stateless-validator because it skips validation steps:

| Component | Approx. Cycle % (Validator) | Present in Executor? |
|-----------|:---------------------------:|:--------------------:|
| Header validation | 5-10% | ❌ No |
| State root verification | 10-20% | ❌ No |
| EVM execution | 40-60% | ✅ Yes |
| Post-execution validation | 10-20% | ❌ No |
| Receipts root computation | 5-15% | ❌ No |

*Percentages are approximate and vary based on block composition*

### When Cycle Counts Matter

- **Executor cycles**: Represent the minimum zkVM cost for processing transactions
- **Validator cycles**: Represent the realistic cost of proving a block's validity

For accurate zkEVM proving cost estimates, use **stateless-validator**. For pure execution research, use **stateless-executor**.

---

## Input Compatibility

Both guest programs use the same input fixtures generated by `witness-generator-cli`:

```
zkevm-fixtures-input/
├── block-12345.json    # Can be used by both
├── block-12346.json    # Can be used by both
└── ...
```

This means you can:
- Generate fixtures once
- Run both executor and validator benchmarks on the same fixtures
- Compare results directly

---

## Example Workflows

### Workflow 1: Pure Execution Benchmarking

```bash
# Generate fixtures
./scripts/generate-gas-categorized-fixtures.sh -g 1M

# Run executor benchmarks (pure execution)
./scripts/run-gas-categorized-benchmarks.sh \
  -g stateless-executor \
  -z risc0 \
  -c 1M

# Analyze raw execution cycles
python3 scripts/compare_proving_times.py --zkvm risc0
```

### Workflow 2: Realistic Block Validation

```bash
# Generate fixtures
./scripts/generate-gas-categorized-fixtures.sh -g 1M

# Run validator benchmarks (full validation)
./scripts/run-gas-categorized-benchmarks.sh \
  -g stateless-validator \
  -e reth \
  -z risc0 \
  -c 1M

# Analyze complete validation costs
python3 scripts/compare_proving_times.py --zkvm risc0
```

### Workflow 3: Executor vs Validator Comparison

```bash
# Generate fixtures
./scripts/generate-gas-categorized-fixtures.sh -g 1M

# Run executor benchmarks
./scripts/run-gas-categorized-benchmarks.sh \
  -g stateless-executor \
  -z risc0 \
  -c 1M \
  -o ./zkevm-metrics-executor

# Run validator benchmarks
./scripts/run-gas-categorized-benchmarks.sh \
  -g stateless-validator \
  -e reth \
  -z risc0 \
  -c 1M \
  -o ./zkevm-metrics-validator

# Compare the overhead of validation
python3 scripts/compare_executions.py \
  zkevm-metrics-executor-risc0-1M \
  zkevm-metrics-validator-risc0-1M
```

---

## Metrics Interpretation

### Executor Metrics

The executor reports metrics focused on execution:

```json
{
  "execution": {
    "success": {
      "total_num_cycles": 5000000,
      "region_cycles": {
        "execution": 5000000
      }
    }
  }
}
```

### Validator Metrics

The validator reports metrics including all validation phases:

```json
{
  "execution": {
    "success": {
      "total_num_cycles": 8000000,
      "region_cycles": {
        "verify_witness": 1000000,
        "execution": 5000000,
        "post_state_compute": 1500000,
        "validation": 500000
      }
    }
  }
}
```

Note how the executor's total cycles match only the "execution" region of the validator.

---

## Summary Table

| Aspect | stateless-executor | stateless-validator |
|--------|-------------------|---------------------|
| **Best for** | Opcode research, EVM optimization | Production cost estimation |
| **Execution clients** | Reth only | Reth, Ethrex |
| **Cycle overhead** | Minimal (execution only) | Full (includes validation) |
| **Fixture compatibility** | Same as validator | Same as executor |
| **Typical use case** | "How expensive is SLOAD?" | "How much to prove this block?" |

---

## See Also

- [Stateless Executor Guide](/stateless-executor-guide) - Complete executor documentation
- [Stateless Executor Architecture](/stateless-executor-architecture) - Technical deep dive
- [Gas Categorized Benchmarks](/gas-categorized-benchmarks) - Running benchmarks

